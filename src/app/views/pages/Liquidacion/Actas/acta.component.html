<div class="cli-card fit-card">
  <div class="cli-card-body">
    <div class="modal-title c-male">Registro de Actas</div>
    <div>
      <!-- BUSCADOR POR FILTRO ---------------------------------------------------------------->
      <form [formGroup]="actasForm">
        <div class="card" style="border-radius: 2px; font-weight: 600">
          <div class="row g-3 card-body" style="padding: 10px">

            <div class="col-sm-3 cli-form-element">
              <label class="form-label">ID Acta</label>
              <input
                type="number"
                class="form-control"
                formControlName="codFact"/>
            </div>

            <div class="col-sm-3 cli-form-element">
              <label class="form-label">Gestor</label>
              <select class="form-select" formControlName="id_gestor">
                <option [value]="0" disabled>-Seleccione-</option>
                <option [value]="g.id" *ngFor="let g of listGestores">{{g.nombre}}</option>
              </select>
            </div>

            <div class="col-sm-3 cli-form-element">
              <label class="form-label">Proyecto</label>
              <select class="form-select" formControlName="id_proy">
                <option [value]="0" disabled>-Seleccione-</option>
                <option [value]="proy.id" *ngFor="let proy of listProyectos">{{proy.valor_texto_1}}</option>
              </select>
            </div>


            <!-- <div class="col-sm-3 cli-form-element">
              <label class="form-label">Estado</label>
              <select class="form-select" formControlName="id_estado">
                <option [value]="0" disabled>-Seleccione-</option>
                <option [value]="est.id" *ngFor="let est of listEstados">{{est.nombre}}</option>
              </select>
            </div> -->

            <div class="col-sm-3 cli-form-element">
              <label class="form-label">Importe</label>
              <input
                type="number"
                class="form-control"
                formControlName="importe"/>
            </div>

            <div class="col-sm-3 cli-form-element">
              <div class="form-group">
                <label>Fecha Periodo</label>
                 <input
                  type="month"
                  class="form-control cli-input-white"
                  formControlName="f_periodo"/>
              </div>
            </div>

            <!-- <div class="col-sm-3 cli-form-element" style="margin-top: 45px">
              <div class="form-group">
                <div class="form-check form-check-inline">
                  <input class="form-check-input"
                         type="checkbox"
                         id="inlineCheckbox1"
                         formControlName="periodoActual">
                  <label class="form-check-label" for="inlineCheckbox1">Periodo actual</label>
                </div>
              </div>
            </div> -->

            <div class="cli-form-buttons" style="margin-top: 8px">
              <button
                type="submit"
                class="cli-btn btn-m btn-cancel"
                style="border-radius: 2px; padding: 0.225rem 0.75rem"
                (click)="limpiarFiltro()"
                ><mat-icon class="icon-18">rotate_left</mat-icon>
                Limpiar
              </button>

              <button
                type="button"
                class="cli-btn btn-blue-light"
                style="border-radius: 2px; padding: 0.225rem 0.75rem"
                (click)="getAllActas()"
                ><mat-icon class="icon-18">search</mat-icon>
                Buscar
              </button>
            </div>
          </div>
        </div>

        <!-- BOTON MODAL PARA CREAR LIQUIDACION ----------------------------------------------------->
        <div style="display: flex" class="mt-4 mb-1">
          <!-- <button
            class="btn-crear btn-blue"
            style="margin: 0"
            type="button"
            (click)="crearLiquidacion()"
            ><mat-icon class="icon-18">add</mat-icon>Crear acta
          </button> -->

          <div class="d-flex">
            <button style="margin-top: 10px" class="cli-btn btn-turq"
              (click)="openEditDialog(0, null, true, true, null)"
              ><mat-icon class="icon-18">add</mat-icon>Crear acta
            </button>
          </div>


          <div class="flex-1"></div>
          <div class="mt-2" style="color: #345df3; font-weight: 600;">
            Total : <span class="total">{{ listActas.length }} Actas</span>
          </div>
        </div>
      </form>



      <!-- NUEVO LIQUID CON SUB MENU -->
      <ng-container *ngIf="!loading">
        <table class="cli-table_x stripedtable underlinedtable">
          <thead>
            <tr class="bgc-blue-light c-white">
              <th style="min-width: 120px;"></th>
              <th>ID Acta</th>
              <th>Proyecto</th>
              <th>Subservicio</th>
              <th>Estado</th>
              <th>Total</th>
              <th>Declarado</th>
              <th>Facturado</th>
              <th>Pendiente</th>
              <th>Comentario</th>
            </tr>
          </thead>
        </table>

        <div class="cli-col" *ngFor="let acta of listActas; let i = index">


          <!-- ACTAS -->
        <div class="moad-module">
          <div class="moad-module-title">
          <table class="cli-table_x stripedtable underlinedtable">
            <tbody style="background: #e9eae8;">
                <td><button (click)="showingidx = i" class="icon-btn btn-s btn-turq"><mat-icon class="icon-20">{{ showingidx == i? "keyboard_arrow_down" : "keyboard_arrow_right"}}</mat-icon></button></td>
                <td style="min-width: 140px; font-weight: 400;"><mat-icon style="vertical-align: middle;" [ngClass]="{ 'c-green': acta.enable, 'c-light': !acta.enable }" class="icon-18">{{ acta.icon }}</mat-icon>
                <small style="margin-left: 10px;"> </small>{{ acta.periodo }}: <small style="margin-left: 10px; font-size: 14px;">{{ acta.gestor }}</small>
                </td>
                <!-- <td style="min-width: 140px; font-weight: 400;">{{ acta.periodo }}: <small style="margin-left: 10px; font-size: 14px;">{{ acta.gestor }}</small></td> -->
                <!-- <td style="margin: 0 10px">{{ acta.gestor }}</td> -->
                <!-- <td></td> -->
                <td></td>
                <td></td>
                <td  *ngIf="!acta.enable" class="moad-inactive label_x" >{{acta.estado}}</td>
                <td>[{{ acta.importe }}]</td>
                <td style="flex: 1 1;"></td>
                <!-- <td></td>
                <td></td> -->
            </tbody>
          </table>
         </div>




          <!-- BUTTONS EDIT - ADD -->
          <div class="moad-actions">
            <button
              matTooltip="Eliminar acta"
              (click)="openEditDialog(i, acta, false, false, acta.text)"
              class="icon-btn btn-trans c-fucsia">
              <mat-icon class="icon-18">delete</mat-icon>
            </button>

            <button
              matTooltip="Editar acta"
              (click)="openEditDialog(i, acta, true, false, acta.text)"
              class="icon-btn btn-trans c-yellow"
              ><mat-icon class="icon-18">edit</mat-icon>
            </button>

            <button
              matTooltip="Agregar detalle"
              (click)="openEditDialog(i, acta, false, true, acta.text)"
              class="icon-btn btn-trans c-green"
              ><mat-icon class="icon-18">add</mat-icon>
            </button>
          </div>
        </div>

        <!-- SUBMENUS DETALLE ACTA-->
        <div *ngIf="showingidx == i" class="moad-menus">
          <div class="moad-menu" style="color:#a4a5a6; justify-content: center;" *ngIf="acta.detalle_acta.length == 0">AÃºn no se agregan DETALLES a esta Acta</div>

          <div style="overflow: auto; color:#6c757d;">
            <table class="cli-table_x stripedtable underlinedtable">
              <tbody>
                <tr *ngFor="let detalle of acta.detalle_acta">
                  <td></td>
                  <td>
                    <div class="moad-actions">
                      <button (click)="openEditDialog(i, detalle, false, false, acta.text)"
                        class="icon-btn btn-trans" style="color: #69aafa;">
                        <mat-icon class="icon-15">drive_file_rename_outline</mat-icon>
                      </button>

                      <button (click)="openEditDialog(i, detalle, false, false, acta.text)"
                        class="icon-btn btn-trans c-fucsia">
                        <mat-icon class="icon-15">delete_forever</mat-icon>
                      </button>
                    </div>
                  </td>
                  <td style="text-align: left; min-width: 95px;">{{ detalle.acta }}</td>
                  <td>{{ detalle.proyecto    }}</td>
                  <td style="min-width: 125px;">{{ detalle.subservicio }}</td>
                  <td>{{ detalle.estado      }}</td>
                  <td>{{ detalle.venta_total }}</td>
                  <td>{{ detalle.declarado   }}</td>
                  <td>{{ detalle.facturado   }}</td>
                  <td>{{ detalle.pendiente   }}</td>
                  <td style="text-align: left; min-width: 125px">{{ detalle.comentario }}</td>
                </tr>
              </tbody>
            </table>

            <!-- <div class="cli-loader" *ngIf="loadingItem">
              <mat-spinner style="margin-right: 20px" diameter="20"></mat-spinner>
              cargando...
            </div> -->
          </div>
        </div>
      </div>




    </ng-container>

    <div class="cli-loader" *ngIf="loading">
      <mat-spinner diameter="40"></mat-spinner>
    </div>






    </div>

    <div class="card-footer pb-0 pt-3">
      <pagination-controls
        previousLabel="Anterior"
        nextLabel="Siguiente"
        [responsive]="false"
        (pageChange)="cambiarPagina($event)">
      </pagination-controls>
    </div>
  </div>
</div>











